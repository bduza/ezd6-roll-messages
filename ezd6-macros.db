{"name":"Roll Resistance/Aloofness","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/stoned.svg","command":"let type = 'Resistance'\nif (game.user.isGM)\ntype = await new Promise((resolve)=>{\n        new Dialog({\n         title: 'Resistance or Aloofness?',\n         content:  ``,\n         render: (html) => {\n           html.parent().css({background:'unset', color: 'white'})\n            html.find('button, input').css({background:'unset', color: 'white'})\n         },\n         buttons: {\n             resist : { label : `Resistance`, callback : (html) => {resolve(`Resistance`);}},\n             aloof : { label : `Aloofness`, callback : (html) => {resolve(`Aloofness`);}}\n         },\n         default: 'resist',\n         close:   html => {\n             return resolve('')}\n           },{top: window.innerHeight-300, width: 'auto', id: \"R-or-F\"}\n        ).render(true);\n    });\nif (!type) return ui.notifications.info(\"Resist or Aloof not selected\");\nlet formula = await ezd6.magickDialog(`${type} Roll`);\nif (!formula) return ui.notifications.info(\"Spell Cast Cancelled\");\nreturn await new Roll(formula).toMessage({flavor: `${type} Roll: ` + formula});","ownership":{"default":2,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"yGbebxaD52rblKfC"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667148258410,"modifiedTime":1674479274767,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"HuAp7zaIARljb4m0"}
{"name":"Attack","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/sword.svg","command":"try { ui.chat.processMessage(`/r ${await ezd6.rollDialog(`${actor?.name} Attack`)} # Attack`) } catch ( err ){ console.log(error) }","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"JAJAOQaIVH1G0tn4"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667131241782,"modifiedTime":1674479274734,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"JMhqUaUjcRMOzYXh"}
{"name":"Confirm Crit","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"modules/ezd6-roll-messages/inverted-dice-6-white.svg","command":"let pips = ['zero', 'one', 'two', 'three', 'four', 'five', 'six'];\nlet message = game.messages.contents.filter(m=>m.user==game.user&&m.flags.ezd6?.results?.length).reverse()[0];\n\nif (!message) \n  return ui.notifications.warn('No message with results found.');\nlet resultsActive6 = message.flags.ezd6?.results?.filter(r=>r.result==6 && r.active);\nlet resultsOriginalCrit = !!resultsActive6.filter(r=>!r.hasOwnProperty('count') && r.active).length;\nlet confirmRolls = message.flags.ezd6?.results?.filter(r=>r.hasOwnProperty('count'));\nif (!message.flavor.toUpperCase().includes('ATTACK'))\n  return ui.notifications.warn('Your last roll was not an attack.');\nif (!resultsActive6.length)\n  return ui.notifications.warn('You did not roll a 6 on your attack.');\nif (!resultsOriginalCrit)\n  return ui.notifications.warn('Your attack roll was not a 6.');\nif (confirmRolls.length)\n  if (!confirmRolls.at(-1)?.success)\n    return ui.notifications.warn('Your last roll was not a 6.');\nlet roll = await new Roll('1d6cs>=6').roll();\nif (game.modules.get('dice-so-nice')?.active)\n  await game.dice3d.showForRoll(roll, game.user, true);\nlet results = [...message.flags.ezd6.results, ...roll.dice.reduce((a,x)=>{return [...a, ...x.results]}, [])];\nlet actions = [];\nif (message.flags.ezd6.actions?.length)\n  actions = [...message.flags.ezd6.actions];\nactions.push(`Rolled die ${results.length} to confirm a crit - ${ezd6.d6pips[results[results.length-1].result]}`)\nawait message.update({content:roll.total, flags:{ezd6:{results, actions}}});\nconsole.log(roll)\nif (roll.total==1) this.execute();","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"DCvTbOhdbTaqrDz7"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667135988098,"modifiedTime":1674479274726,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"MBOe5KP4rCi4grFq"}
{"name":"Use Hero Die","type":"script","author":"gxk0TBuEUutgkf9m","img":"modules/ezd6-roll-messages/inverted-dice-1-white.svg","scope":"global","command":"let message = game.messages.contents.reverse().filter(m=>m.user==game.user && m.flags.ezd6?.results)[0];\nreturn ezd6.useHeroDie(message)\n\nlet save = Number(message.rolls[0].formula.split('>=')[1])\nlet actions = [];\nif (message.flags.ezd6?.actions) actions = message.flags.ezd6?.actions;\n\nlet results = [...message.flags.ezd6?.results];\nlet index = results.findLastIndex(r=>r.active)\nif (message.flavor.includes('Cast') && results.find(r=>r.result == 1)) index = results.findIndex(r=>r.result == 1)\nlet result = results[index];\nlet roll = result.result;\nif (roll == 6) return ui.notifications.warn(\"Cannot use Hero Die on a roll of 6. Why would you?\");\nlet hd = await new Roll('1d6').roll();\nif (game.modules.get('dice-so-nice')?.active) await game.dice3d.showForRoll(hd, game.user, true);\nresults[index].result = hd.total;\nif (results[index].hasOwnProperty('success') && results[index].result >= save) results[index].success = true;\nif (results[index].hasOwnProperty('success') && results[index].result <  save) results[index].success = false;\nactions.push(`${game.user.character?.name || game.user.name} used a Hero Die on die ${index+1} - ${ezd6.herodice}</i>`);\nawait game.user.character.update({system:{herodice:game.user.character.system.herodice-1}});\nreturn await message.update({flags:{ezd6:{results, actions}}});\nawait ezd6.socket.executeAsGM(\"updateChatMessage\", message.id, {flags:{ezd6:{results, actions}}});","ownership":{"default":0,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"5vfxW7iAerGlapiV"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1674268451085,"modifiedTime":1674479274704,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"OSKVsxjr4eGkOWJi"}
{"name":"Cast","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/daze.svg","command":"try { ui.chat.processMessage(`/r ${await ezd6.magickDialog(`${actor?.name} Cast Spell/Miracle`)} # Cast`) } catch ( err ){ console.log(error) }","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"cflW1na61BT0Ra0x"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667138806065,"modifiedTime":1674479274747,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"PftfqWmpgq8x4BSc"}
{"name":"EZD6 RR Dialog","type":"script","author":"gxk0TBuEUutgkf9m","img":"systems/ezd6/assets/icons/dmscotty_white_nobg.webp","scope":"global","command":"ezd6.renderRabbleRouserDialog()","ownership":{"default":2,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"p94lfDGBptTDhBiO"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1670154475753,"modifiedTime":1674479274762,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"Tzje6ts8KhT12pqH"}
{"name":"Miraculous Save","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/angel.svg","command":"try { ui.chat.processMessage(`/r ${await ezd6.rollDialog(`${actor?.name} Miraculous Save`)}cs>=@miraculoussave # Armor Save`) } catch ( err ){ console.log(error) }","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"nVzixaVyhuI6BdGt"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667151876563,"modifiedTime":1674479274756,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"dK1IkVfXJlDDQtl7"}
{"name":"Buy Hero Die","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/coins.svg","command":"if (character.system.herodice>0) \n  return ui.notifications.warn(\"You already have a Hero Die\");\nif (character.system.karma<5) \n  return ui.notifications.warn(\"You do not have enough karma to buy a Hero Die\");\nawait character.update({\n  system: {\n    karma: game.user.character.system.karma-5,\n    herodice: game.user.character.system.herodice+1\n  }\n});\nawait ChatMessage.create({speaker: ChatMessage.getSpeaker({actor:game.user.character}), content: `Spent 5 karma to buy a hero die.`});","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"evLJGu2jopzcV1R3"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667180422757,"modifiedTime":1674479274752,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"rc7Ie3qc4p8KBXKw"}
{"name":"Armor Save","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/shield.svg","command":"try { ui.chat.processMessage(`/r ${await ezd6.rollDialog(`${actor?.name} Armor Save`)}cs>=@armorsave # Armor Save`) } catch ( err ){ console.log(error) }","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"5Gy8DOS0sF4X1Bbq"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667151891064,"modifiedTime":1674479274698,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"uLuIfF4iSgWVJNRy"}
{"name":"Use Karma","type":"script","author":"gxk0TBuEUutgkf9m","img":"icons/svg/circle.svg","scope":"global","command":"let message = game.messages.contents.reverse().filter(m=>m.user==game.user && m.flags.ezd6?.results)[0];\nreturn ezd6.useKarma(message)\n\nlet save = Number(message.rolls[0].formula.split('>=')[1])\nlet actions = [];\nif (message.flags.ezd6?.actions) actions = message.flags.ezd6?.actions;\nif (message.flavor.includes('Cast')) return ui.notifications.notify('You cannot use Karma on cast rolls.')\nlet results = [...message.flags.ezd6?.results];\nlet index = results.findLastIndex(r=>r.active)\nlet result = results[index];\nlet roll = result.result;\nif (roll == 6) return ui.notifications.warn(\"Cannot use Karma on a roll of 6. Why would you?\");\nresults[index].result = roll + 1;\nif (results[index].hasOwnProperty('success') && results[index].result >= save) results[index].success = true;\nif (results[index].hasOwnProperty('success') && results[index].result <  save) results[index].success = false;\nactions.push(`${character?.name || game.user.name} used a Karma on die ${index+1} - ${ezd6.karma}`);\nawait game.user.character.update({system:{karma:game.user.character.system.karma-1}});\nreturn await message.update({flags:{ezd6:{results, actions}}});\nawait ezd6.socket.executeAsGM(\"updateChatMessage\", message.id, {flags:{ezd6:{results, actions}}});","ownership":{"default":0,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"9bfYW160qlRseQpO"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1674265112549,"modifiedTime":1674479274717,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"uMs0uZqH2YMiCww7"}
{"name":"Confirm Crit 5+","type":"script","author":"gxk0TBuEUutgkf9m","img":"modules/ezd6-roll-messages/inverted-dice-5-white.svg","scope":"global","command":"let pips = ['zero', 'one', 'two', 'three', 'four', 'five', 'six'];\nlet message = game.messages.contents.filter(m=>m.user==game.user&&m.flags.ezd6?.results?.length).reverse()[0];\nif (!message) \n  return ui.notifications.warn('No message with results found.');\nlet resultsActive6 = message.flags.ezd6?.results?.filter(r=>r.result>=5 && r.active);\nlet resultsOriginalCrit = !!resultsActive6.filter(r=>!r.hasOwnProperty('count') && r.active).length;\nlet confirmRolls = message.flags.ezd6?.results?.filter(r=>r.hasOwnProperty('count'));\nif (!message.flavor.toUpperCase().includes('ATTACK'))\n  return ui.notifications.warn('Your last roll was not an attack.');\nif (!resultsActive6.length)\n  return ui.notifications.warn('You did not roll a 5+ on your attack.');\nif (!resultsOriginalCrit)\n  return ui.notifications.warn('Your attack roll was not a 5+.');\nif (confirmRolls.length)\n  if (!confirmRolls.at(-1)?.success)\n    return ui.notifications.warn('Your last roll was not a 5+.');\nlet roll = await new Roll('1d6cs>=5').roll();\nif (game.modules.get('dice-so-nice')?.active)\n  await game.dice3d.showForRoll(roll, game.user, true);\nlet results = [...message.flags.ezd6.results, ...roll.dice.reduce((a,x)=>{return [...a, ...x.results]}, [])];\nlet actions = [];\nif (message.flags.ezd6.actions?.length)\n  actions = [...message.flags.ezd6.actions];\nactions.push(`Rolled die ${results.length} to confirm a crit - ${ezd6.d6pips[results[results.length-1].result]}`)\nawait  message.update({content:roll.total, flags:{ezd6:{results, actions}}});\nif (roll.total==1) this.execute();","ownership":{"default":2,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"yvsVJnHmuJH3WZiI"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1673650149601,"modifiedTime":1674479274771,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"vHVL9o6BDfyG1vQm"}
{"name":"EZd6 Player Dialog","type":"script","author":"gxk0TBuEUutgkf9m","img":"icons/svg/cowled.svg","scope":"global","command":"ezd6.renderPlayerDialog()","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"YKjEjtLY1jE3cvCH"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1670156561005,"modifiedTime":1674479274739,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"wTM424b2QaUScw8j"}
{"name":"Perform Task","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/falling.svg","command":"try { ui.chat.processMessage(`/r ${await ezd6.rollDialog(`${actor?.name} Task`)} # Task`) } catch ( err ){ console.log(error) }","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"9RKmXJNnkFZSEH6m"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667148861300,"modifiedTime":1674479274713,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"yNfsab2nYqq8QRiK"}
{"$$deleted":true,"_id":"uLuIfF4iSgWVJNRy"}
{"$$deleted":true,"_id":"JMhqUaUjcRMOzYXh"}
{"$$deleted":true,"_id":"rc7Ie3qc4p8KBXKw"}
{"$$deleted":true,"_id":"PftfqWmpgq8x4BSc"}
{"$$deleted":true,"_id":"MBOe5KP4rCi4grFq"}
{"$$deleted":true,"_id":"vHVL9o6BDfyG1vQm"}
{"$$deleted":true,"_id":"wTM424b2QaUScw8j"}
{"$$deleted":true,"_id":"Tzje6ts8KhT12pqH"}
{"$$deleted":true,"_id":"dK1IkVfXJlDDQtl7"}
{"$$deleted":true,"_id":"yNfsab2nYqq8QRiK"}
{"$$deleted":true,"_id":"HuAp7zaIARljb4m0"}
{"$$deleted":true,"_id":"OSKVsxjr4eGkOWJi"}
{"$$deleted":true,"_id":"uMs0uZqH2YMiCww7"}
{"name":"Armor Save","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/shield.svg","command":"ui.chat.processMessage(`/r ${await ezd6.rollDialog(`${actor?.name} Armor Save`)}cs>=@armorsave # Armor Save`)","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"5Gy8DOS0sF4X1Bbq"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667151891064,"modifiedTime":1674480298418,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"27LBcVxejG4ggsiO"}
{"name":"Use Hero Die","type":"script","author":"gxk0TBuEUutgkf9m","img":"modules/ezd6-roll-messages/inverted-dice-1-white.svg","scope":"global","command":"let message = game.messages.contents.reverse().filter(m=>m.user==game.user && m.flags.ezd6?.results)[0];\nreturn ezd6.useHeroDie(message)\n\nlet save = Number(message.rolls[0].formula.split('>=')[1])\nlet actions = [];\nif (message.flags.ezd6?.actions) actions = message.flags.ezd6?.actions;\n\nlet results = [...message.flags.ezd6?.results];\nlet index = results.findLastIndex(r=>r.active)\nif (message.flavor.includes('Cast') && results.find(r=>r.result == 1)) index = results.findIndex(r=>r.result == 1)\nlet result = results[index];\nlet roll = result.result;\nif (roll == 6) return ui.notifications.warn(\"Cannot use Hero Die on a roll of 6. Why would you?\");\nlet hd = await new Roll('1d6').roll();\nif (game.modules.get('dice-so-nice')?.active) await game.dice3d.showForRoll(hd, game.user, true);\nresults[index].result = hd.total;\nif (results[index].hasOwnProperty('success') && results[index].result >= save) results[index].success = true;\nif (results[index].hasOwnProperty('success') && results[index].result <  save) results[index].success = false;\nactions.push(`${game.user.character?.name || game.user.name} used a Hero Die on die ${index+1} - ${ezd6.herodice}</i>`);\nawait game.user.character.update({system:{herodice:game.user.character.system.herodice-1}});\nreturn await message.update({flags:{ezd6:{results, actions}}});\nawait ezd6.socket.executeAsGM(\"updateChatMessage\", message.id, {flags:{ezd6:{results, actions}}});","ownership":{"default":0,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"5vfxW7iAerGlapiV"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1674268451085,"modifiedTime":1674480298424,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"RkMED3p1Zd48CRw7"}
{"name":"Perform Task","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/falling.svg","command":"ui.chat.processMessage(`/r ${await ezd6.rollDialog(`${actor?.name} Task`)} # Task`)","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"9RKmXJNnkFZSEH6m"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667148861300,"modifiedTime":1674480298430,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"rfbninWI4EANvWdM"}
{"name":"Use Karma","type":"script","author":"gxk0TBuEUutgkf9m","img":"icons/svg/circle.svg","scope":"global","command":"let message = game.messages.contents.reverse().filter(m=>m.user==game.user && m.flags.ezd6?.results)[0];\nreturn ezd6.useKarma(message)\n\nlet save = Number(message.rolls[0].formula.split('>=')[1])\nlet actions = [];\nif (message.flags.ezd6?.actions) actions = message.flags.ezd6?.actions;\nif (message.flavor.includes('Cast')) return ui.notifications.notify('You cannot use Karma on cast rolls.')\nlet results = [...message.flags.ezd6?.results];\nlet index = results.findLastIndex(r=>r.active)\nlet result = results[index];\nlet roll = result.result;\nif (roll == 6) return ui.notifications.warn(\"Cannot use Karma on a roll of 6. Why would you?\");\nresults[index].result = roll + 1;\nif (results[index].hasOwnProperty('success') && results[index].result >= save) results[index].success = true;\nif (results[index].hasOwnProperty('success') && results[index].result <  save) results[index].success = false;\nactions.push(`${character?.name || game.user.name} used a Karma on die ${index+1} - ${ezd6.karma}`);\nawait game.user.character.update({system:{karma:game.user.character.system.karma-1}});\nreturn await message.update({flags:{ezd6:{results, actions}}});\nawait ezd6.socket.executeAsGM(\"updateChatMessage\", message.id, {flags:{ezd6:{results, actions}}});","ownership":{"default":0,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"9bfYW160qlRseQpO"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1674265112549,"modifiedTime":1674480298435,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"VM01G6mV0SZo9Grg"}
{"name":"Confirm Crit","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"modules/ezd6-roll-messages/inverted-dice-6-white.svg","command":"let pips = ['zero', 'one', 'two', 'three', 'four', 'five', 'six'];\nlet message = game.messages.contents.filter(m=>m.user==game.user&&m.flags.ezd6?.results?.length).reverse()[0];\n\nif (!message) \n  return ui.notifications.warn('No message with results found.');\nlet resultsActive6 = message.flags.ezd6?.results?.filter(r=>r.result==6 && r.active);\nlet resultsOriginalCrit = !!resultsActive6.filter(r=>!r.hasOwnProperty('count') && r.active).length;\nlet confirmRolls = message.flags.ezd6?.results?.filter(r=>r.hasOwnProperty('count'));\nif (!message.flavor.toUpperCase().includes('ATTACK'))\n  return ui.notifications.warn('Your last roll was not an attack.');\nif (!resultsActive6.length)\n  return ui.notifications.warn('You did not roll a 6 on your attack.');\nif (!resultsOriginalCrit)\n  return ui.notifications.warn('Your attack roll was not a 6.');\nif (confirmRolls.length)\n  if (!confirmRolls.at(-1)?.success)\n    return ui.notifications.warn('Your last roll was not a 6.');\nlet roll = await new Roll('1d6cs>=6').roll();\nif (game.modules.get('dice-so-nice')?.active)\n  await game.dice3d.showForRoll(roll, game.user, true);\nlet results = [...message.flags.ezd6.results, ...roll.dice.reduce((a,x)=>{return [...a, ...x.results]}, [])];\nlet actions = [];\nif (message.flags.ezd6.actions?.length)\n  actions = [...message.flags.ezd6.actions];\nactions.push(`Rolled die ${results.length} to confirm a crit - ${ezd6.d6pips[results[results.length-1].result]}`)\nawait message.update({content:roll.total, flags:{ezd6:{results, actions}}});\nconsole.log(roll)\nif (roll.total==1) this.execute();","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"DCvTbOhdbTaqrDz7"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667135988098,"modifiedTime":1674480298440,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"imlfh83CW2ey6d3Q"}
{"name":"Attack","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/sword.svg","command":"ui.chat.processMessage(`/r ${await ezd6.rollDialog(`${actor?.name} Attack`)} # Attack`)","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"JAJAOQaIVH1G0tn4"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667131241782,"modifiedTime":1674480298447,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"r12d7Uf8IDuTFur0"}
{"name":"EZd6 Player Dialog","type":"script","author":"gxk0TBuEUutgkf9m","img":"icons/svg/cowled.svg","scope":"global","command":"ezd6.renderPlayerDialog()","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"YKjEjtLY1jE3cvCH"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1670156561005,"modifiedTime":1674480298453,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"j06c5U3oMGKRxMKd"}
{"name":"Cast","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/daze.svg","command":"ui.chat.processMessage(`/r ${await ezd6.magickDialog(`${actor?.name} Cast Spell/Miracle`)} # Cast`)","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"cflW1na61BT0Ra0x"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667138806065,"modifiedTime":1674480298459,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"7Zfvaa6jvuIF1ssI"}
{"name":"Buy Hero Die","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/coins.svg","command":"if (character.system.herodice>0) \n  return ui.notifications.warn(\"You already have a Hero Die\");\nif (character.system.karma<5) \n  return ui.notifications.warn(\"You do not have enough karma to buy a Hero Die\");\nawait character.update({\n  system: {\n    karma: game.user.character.system.karma-5,\n    herodice: game.user.character.system.herodice+1\n  }\n});\nawait ChatMessage.create({speaker: ChatMessage.getSpeaker({actor:game.user.character}), content: `Spent 5 karma to buy a hero die.`});","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"evLJGu2jopzcV1R3"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667180422757,"modifiedTime":1674480298464,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"WgJBhspzBdjxmJgt"}
{"name":"Miraculous Save","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/angel.svg","command":"ui.chat.processMessage(`/r ${await ezd6.rollDialog(`${actor?.name} Miraculous Save`)}cs>=@miraculoussave # Miraculous Save`)","ownership":{"default":2,"gxk0TBuEUutgkf9m":3,"pNR8bgLbPWFFipAO":2},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"nVzixaVyhuI6BdGt"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667151876563,"modifiedTime":1674480298470,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"l14FAZU6vjY8a9Bs"}
{"name":"EZD6 RR Dialog","type":"script","author":"gxk0TBuEUutgkf9m","img":"systems/ezd6/assets/icons/dmscotty_white_nobg.webp","scope":"global","command":"ezd6.renderRabbleRouserDialog()","ownership":{"default":2,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"p94lfDGBptTDhBiO"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1670154475753,"modifiedTime":1674480298475,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"69gDCWUXRXh01FsN"}
{"name":"Roll Resistance/Aloofness","type":"script","scope":"global","author":"gxk0TBuEUutgkf9m","img":"icons/svg/stoned.svg","command":"let type = 'Resistance'\nif (game.user.isGM)\ntype = await new Promise((resolve)=>{\n        new Dialog({\n         title: 'Resistance or Aloofness?',\n         content:  ``,\n         render: (html) => {\n           html.parent().css({background:'unset', color: 'white'})\n            html.find('button, input').css({background:'unset', color: 'white'})\n         },\n         buttons: {\n             resist : { label : `Resistance`, callback : (html) => {resolve(`Resistance`);}},\n             aloof : { label : `Aloofness`, callback : (html) => {resolve(`Aloofness`);}}\n         },\n         default: 'resist',\n         close:   html => {\n             return resolve('')}\n           },{top: window.innerHeight-300, width: 'auto', id: \"R-or-F\"}\n        ).render(true);\n    });\nif (!type) return ui.notifications.info(\"Resist or Aloof not selected\");\nui.chat.processMessage(`/r ${ await ezd6.magickDialog(`${type}`)} # ${type}`);","ownership":{"default":2,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"yGbebxaD52rblKfC"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1667148258410,"modifiedTime":1674480298480,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"3jRBvLsWoNO0jWQW"}
{"name":"Confirm Crit 5+","type":"script","author":"gxk0TBuEUutgkf9m","img":"modules/ezd6-roll-messages/inverted-dice-5-white.svg","scope":"global","command":"let pips = ['zero', 'one', 'two', 'three', 'four', 'five', 'six'];\nlet message = game.messages.contents.filter(m=>m.user==game.user&&m.flags.ezd6?.results?.length).reverse()[0];\nif (!message) \n  return ui.notifications.warn('No message with results found.');\nlet resultsActive6 = message.flags.ezd6?.results?.filter(r=>r.result>=5 && r.active);\nlet resultsOriginalCrit = !!resultsActive6.filter(r=>!r.hasOwnProperty('count') && r.active).length;\nlet confirmRolls = message.flags.ezd6?.results?.filter(r=>r.hasOwnProperty('count'));\nif (!message.flavor.toUpperCase().includes('ATTACK'))\n  return ui.notifications.warn('Your last roll was not an attack.');\nif (!resultsActive6.length)\n  return ui.notifications.warn('You did not roll a 5+ on your attack.');\nif (!resultsOriginalCrit)\n  return ui.notifications.warn('Your attack roll was not a 5+.');\nif (confirmRolls.length)\n  if (!confirmRolls.at(-1)?.success)\n    return ui.notifications.warn('Your last roll was not a 5+.');\nlet roll = await new Roll('1d6cs>=5').roll();\nif (game.modules.get('dice-so-nice')?.active)\n  await game.dice3d.showForRoll(roll, game.user, true);\nlet results = [...message.flags.ezd6.results, ...roll.dice.reduce((a,x)=>{return [...a, ...x.results]}, [])];\nlet actions = [];\nif (message.flags.ezd6.actions?.length)\n  actions = [...message.flags.ezd6.actions];\nactions.push(`Rolled die ${results.length} to confirm a crit - ${ezd6.d6pips[results[results.length-1].result]}`)\nawait  message.update({content:roll.total, flags:{ezd6:{results, actions}}});\nif (roll.total==1) this.execute();","ownership":{"default":2,"gxk0TBuEUutgkf9m":3},"flags":{"advanced-macros":{"runAsGM":false},"socketmacros":{"isSocket":false},"ezd6-roll-messages":{"id":"yvsVJnHmuJH3WZiI"}},"_stats":{"systemId":"ezd6","systemVersion":"1.1.1","coreVersion":"10.291","createdTime":1673650149601,"modifiedTime":1674480298484,"lastModifiedBy":"gxk0TBuEUutgkf9m"},"folder":null,"sort":0,"_id":"mYb57TpHf8m9fx2w"}
